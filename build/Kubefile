FROM scratch

USER 65532:65532
COPY charts  ./charts
# COPY manifests ./manifests
COPY registry ./registry
COPY start.sh ./start.sh
COPY prometheus-helm.yaml ./prometheus-helm.yaml
COPY mongodb.yaml ./mongodb.yaml

ENV DOMAIN=127.0.0.1.nip.io
ENV NAMESPACE=laf-system
ENV REGION=default
ENV EXTERNAL_HTTP_SCHEMA=http
ENV INTERNAL_HTTP_SCHEMA=http
ENV ENABLE_MONITOR=true


ENV DB_PV_SIZE=10Gi
ENV OSS_PV_SIZE=20Gi
ENV PROMETHEUS_PV_SIZE=20Gi

CMD ["DOMAIN=$(DOMAIN) REGION=$(REGION) NAMESPACE=$(NAMESPACE) EXTERNAL_HTTP_SCHEMA=$(EXTERNAL_HTTP_SCHEMA) INTERNAL_HTTP_SCHEMA=$(INTERNAL_HTTP_SCHEMA) DB_PV_SIZE=$(DB_PV_SIZE) OSS_PV_SIZE=$(OSS_PV_SIZE) PROMETHEUS_PV_SIZE=$(PROMETHEUS_PV_SIZE) ENABLE_MONITOR=$(ENABLE_MONITOR) sh start.sh"]